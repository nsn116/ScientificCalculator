<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scientific Calculator</title>
</head>
<body style="text-align: center; padding-top: 14%; background-image: url('images/background.jpg'); ">
<input class = "gsfi" id = "lst-ib" maxlength="2048" name="output" type="text" title="output">
<br />
<button class="Button" type="button" onclick="switchOff()">OFF</button>
<button class="Button" type="button" onclick="reset()">AC</button>
<button class="Button" type="button" onclick="backspace();"><-</button>
<br />
<button class="Button" type="button" onclick="clicked(1)">1</button>
<button class="Button" type="button" onclick="clicked(2)">2</button>
<button class="Button" type="button" onclick="clicked(3)">3</button>
<br />
<button class="Button" type="button" onclick="clicked(4)">4</button>
<button class="Button" type="button" onclick="clicked(5)">5</button>
<button class="Button" type="button" onclick="clicked(6)">6</button>
<br />
<button class="Button" type="button" onclick="clicked(7)">7</button>
<button class="Button" type="button" onclick="clicked(8)">8</button>
<button class="Button" type="button" onclick="clicked(9)">9</button>
<br />
<button class="Button" type="button" onclick="equals()">=</button>
<button class="Button" type="button" onclick="clicked(0)">0</button>
<button class="Button" type="button" onclick="sum()">+</button>
<br />
<button class="Button" type="button" onclick="subtraction()">-</button>
<button class="Button" type="button" onclick="multiplication()">*</button>
<button class="Button" type="button" onclick="division()">/</button>
<br />
<button class="Button" type="button" onclick="sine()">sin</button>
<button class="Button" type="button" onclick="cosine()">cos</button>
<button class="Button" type="button" onclick="tangent()">tan</button>
<br />
<button class="Button" type="button" onclick="squareRoot()">√</button>
<button class="Button" type="button" onclick="log10()">log</button>
<button class="Button" type="button" onclick="logE()">ln</button>
<br />
<button class="Button" type="button" onclick="pi()">π</button>
<button class="Button" type="button" onclick="negate()">+ / -</button>
<button class="Button" type="button" onclick="e()">e</button>
<br />
<button class="Button" type="button" onclick="percentage()">%</button>
<button class="Button" type="button" onclick="power()">xⁿ</button>
<button class="Button" type="button" onclick="decimal()">.</button>
<br />
<style>
  .gsfi {
    margin-bottom: 6.5%;
    width: 40%;
    padding: 1% 0 1% 0;
    text-align: center;
  }
  .Button {
    align-content: center;
    height: 20%;
    width: 20%;
    padding: 1% 0 1% 0;
  }
</style>
<script>
  var solution = 0;
  var operand1 = 0;
  var operand2 = 0;
  var temp = 0;
  var lastSetOperand1 = false;
  var lastSetOperand2 = false;
  var isSolutionInfinity = false;
  var isInvalidOperation = false;
  var operationPending = false;
  var isDecimal = false;
  var sinceDecimal = 1;
  var pendingOperation;

  function switchOff() {
    window.close();
  }

  function currentTextMessage() {
    return document.getElementById("lst-ib").value;
  }
  
  function backspace() {
    var lastChar = currentTextMessage().charAt(currentTextMessage().length - 1);
    if (!isNaN(Number(lastChar)) && lastChar !== " ") {
      document.getElementById("lst-ib").value = currentTextMessage().substring(0, currentTextMessage().length - 1);
      temp = (temp - (temp % 10)) / 10;
      // TODO : Fix the code commented below to make backspace work for decimals as well.
//      if (sinceDecimal > 1) {
//        temp = (temp - (temp % 10)) / 10;
//      } else {
//        temp -= (Number(lastChar) / Math.pow(10, sinceDecimal - 1));
//        sinceDecimal--;
//      }
    } else {
      // PRE: This function will only undo +, *, -, / operations.
      // TODO: Although the other functions are easy to undo, due to time
      // TODO: constraints I will be ignoring them for now.
      document.getElementById("lst-ib").value = currentTextMessage().substring(0, currentTextMessage().length - 3);
      operationPending = false;
      pendingOperation = undefined;
      if (lastSetOperand1) {
        temp = operand1;
        lastSetOperand1 = false;
        lastSetOperand2 = true;
      } else {
        temp = operand2;
        lastSetOperand2 = false;
        lastSetOperand1 = true;
      }
    }
  }

  function sum() {
    clicked();
    document.getElementById("lst-ib").value += " + ";
    pendingOperation = plus();
    operationPending = true;
  }

  function plus() {
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    return function (number) {
      solution = number + lastSet;
    };
  }

  function subtraction() {
    clicked();
    document.getElementById("lst-ib").value += " - ";
    pendingOperation = minus();
    operationPending = true;
  }

  function minus() {
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    return function (number) {
      solution = lastSet - number;
    };
  }

  function multiplication() {
    clicked();
    document.getElementById("lst-ib").value += " * ";
    pendingOperation = prod();
    operationPending = true;
  }

  function prod() {
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    return function (number) {
      solution = number * lastSet;
    };
  }

  function division() {
    clicked();
    document.getElementById("lst-ib").value += " / ";
    pendingOperation = div();
    operationPending = true;
  }

  function div() {
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    return function (number) {
      if (number === 0) {
        isSolutionInfinity = true;
      } else {
        solution = lastSet / number;
      }
    };
  }

  function sine() {
    clicked();
    document.getElementById("lst-ib").value = "sin ( " + document.getElementById("lst-ib").value + " )";
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    solution = Math.sin(lastSet);
  }

  function cosine() {
    clicked();
    document.getElementById("lst-ib").value = "cos ( " + document.getElementById("lst-ib").value + " )";
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    solution = Math.cos(lastSet);
  }

  function tangent() {
    clicked();
    document.getElementById("lst-ib").value = "tan ( " + document.getElementById("lst-ib").value + " )";
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    solution = Math.tan(lastSet);
  }

  function squareRoot() {
    clicked();
    document.getElementById("lst-ib").value = "√ " + document.getElementById("lst-ib").value;
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    if (lastSet < 0) {
      isInvalidOperation = true;
    } else {
      solution = Math.sqrt(lastSet);
    }
  }

  function log10() {
    clicked();
    document.getElementById("lst-ib").value = "log " + document.getElementById("lst-ib").value;
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    if (lastSet <= 0) {
      isInvalidOperation = true;
    } else {
      solution = Math.log(lastSet) / Math.log(10);
    }
  }

  function logE() {
    clicked();
    document.getElementById("lst-ib").value = "ln " + document.getElementById("lst-ib").value;
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    if (lastSet <= 0) {
      isInvalidOperation = true;
    } else {
      solution = Math.log(lastSet);
    }
  }

  function pi() {
    if (!operationPending) {
      clicked();
      temp = Math.PI;
    } else {
      pendingOperation(Math.PI);
      operationPending = false;
    }
    document.getElementById("lst-ib").value += String(Math.PI);
  }

  function negate() {
    clicked();
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    if (lastSet !== 0) {
      if (lastSet < 0) {
        document.getElementById("lst-ib").value = document.getElementById("lst-ib").value.substring(1);
      } else {
        document.getElementById("lst-ib").value = "-" + document.getElementById("lst-ib").value;
      }
    }
    solution = -1 * lastSet;
    equals();
  }

  function e() {
    if (!operationPending) {
      clicked();
      temp = Math.E;
    } else {
      pendingOperation(Math.E);
      operationPending = false;
    }
    document.getElementById("lst-ib").value += String(Math.E);
  }

  function percentage() {
    document.getElementById("lst-ib").value += "%";
    temp /= 100;
  }

  function power() {
    clicked();
    document.getElementById("lst-ib").value += " raised to ";
    pendingOperation = raise();
    operationPending = true;
  }

  function raise() {
    var lastSet = (lastSetOperand1) ? operand1 : operand2;
    return function (number) {
      solution = Math.pow(lastSet, number);
    };
  }

  function decimal() {
    if (isDecimal) {
      document.getElementById("lst-ib").value = "Invalid Operation ! RESET !!!";
    }
    else {
      document.getElementById("lst-ib").value += ".";
      isDecimal = true;
    }
  }

  function equals() {
    clicked();
    if (isSolutionInfinity) {
      document.getElementById("lst-ib").value = "Cannot divide by zero ! RESET !!!";
    } else if (isInvalidOperation) {
      document.getElementById("lst-ib").value = "Invalid Operation ! RESET !!!";
    } else {
      document.getElementById("lst-ib").value = String(solution);
    }
    temp = solution;
    lastSetOperand1 = false;
    lastSetOperand2 = true;
    solution = 0;
  }

  function clicked(val) {
    if (val === undefined) {
      if (!lastSetOperand1) {
        operand1 = temp;
        lastSetOperand1 = true;
        lastSetOperand2 = false;
        if (operationPending) {
          pendingOperation(operand1);
          operationPending = false;
        }
      } else {
        operand2 = temp;
        lastSetOperand2 = true;
        lastSetOperand1 = false;
        if (operationPending) {
          pendingOperation(operand2);
          operationPending = false;
        }
      }
      temp = 0;
      isDecimal = false;
      sinceDecimal = 1;
    } else {
      if (!isDecimal) {
        temp = temp * 10 + val;
      } else {
        temp += (val / Math.pow(10, sinceDecimal));
        sinceDecimal++;
      }
      document.getElementById("lst-ib").value += String(val);
    }
  }

  function reset() {
    solution = 0;
    operand1 = 0;
    operand2 = 0;
    temp = 0;
    lastSetOperand1 = false;
    lastSetOperand2 = false;
    operationPending = false;
    pendingOperation = false;
    isSolutionInfinity = false;
    isInvalidOperation = false;
    document.getElementById("lst-ib").value = "";
  }

</script>
</body>
</html>